
var viewer = null;
var designer = null;

Stimulsoft.Base.StiLicense.key = "6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHlrzAZzmWmSnQQ4gKFiZ4LJpJv//QjFVXxcHAVbzZfXjyOGPmj/m+BEjr2Z14dWeqLFNGF74GELbTTKs2+Le/9cDIWdGNnOpEK2aGdYllauMPLQsiScC521JIEYSdOspiRHSLcegksxfNedJjyIjGlfI2YrddBRWGiO+uWOHE5oz9hLG8VPBSRo60KmgkscM5X+7+aQ+6vzKKOC2XB+e6BMQC5qNVBUblfGQR2EjNLZKmSJtvek7IbG/OK+XP0j2bwicyJUGC0pyLHqctr3BpcO/gA5LoVfuwqYG3klL//owBkObPPhJV1HD6XsHL0GDryssJFaDCQIyXMrOn7hNQNkEIyx+AJDNgf5XfxPgEgFsRhYCPYq7ccutg2by8duOxbF3xH0gL/uAQN275COXJBV3W62DSLM+o8azChG+Z7y0dF9f4whZ/SKD4DwNPUWK7osEPVwl5BY+0lkdqd67fatlrlc0QU/ZX9f5QcTKfl5ljuNc+kcqxmd9NND6Xzrw9gFsFqIWqqVo++DdoAZFStXMkOp/nTNBQMRA100k3vi2SbbiHq/gVimrQecUhWG0qU5zcemtVGDMs1ruXsoHX8pYX/rMJHH09qCWllVyBykkTLourYEig9g5fhKDYRV05aC0cWsbxR2nj9TH3SLmG4P2Px7uJsq6iOsnIHWuBMwk8oF7xPEugjw+x8lkjVVoV8WWBSdjIxGh4LviZXBEJm9FTJzYcnEHMZRh0uVE1g8crC+TfRVii7dcdZzeQklzyNY+0Q1/hRaIUs+mNPRiqG6YqEv3f+yG4ncxzkCWZDvXPox87y61jbg6Dg73X1RAwwvbIXuJVANbaDOefUELPmpz4SIpHx8zpLSmn1H1u0PolbsimLigcGw2bJQeuU++OBU74vJJde3JdoO6IOfmUJkoxprdszyknLm+zWgnC+jjaCtEZZuOIJqyuVPoqHRiFkqNjbddkvGMmj/4+2D6BdYQot9sEOW7iCgV4SvZ/efC0NlRX+Z+6PODwKJiO+Sen5aAlsJcL2jIUSAjgyS+7im7XTGlYKuRL59EQjA5HArO1ikJ0P/2pk4u91z2J8GRvTPu5BZUI9M0BLGLAVCFMte4JQCOr+f785RgjerSNCSgN4Mfa5+jDQAKTAVAO5tqT/SBEm0M5U1EylQ/fbseKt+dQ1/VzqlQ9SH14jtI0J97ACqk9SBt9xpTgBnJrBSTnnY21l2zWS7/2k5U9LPDJn0Lm32ueoDRFaM4JeK1HoSi2HvOYy1V1hU5pCe893QsBE/HOVp4UWu9lfiEWunHEEdPZOUPgc131KwJrM4K3DYiBbXl442TgbNLfz5IBnAw1NVabMXXyx2LOi6x35xw1YLMRYNWYE9QpocBhoFQtStd2OUZ5CqvxhXf+VaLK3hmm1GvlqpUK6LIDd3eyuQK4f0E7+zVSBaV6eSDI9YJC42Ee+Br8AByGYLRaFISpDculGt2nqwFL6cwltv1Xy11frJR2KqbR8sd6dI0V69XnwBziRzJq1SyAZd9bzClYSpA3ZYPN9ghdaHA+GZak0IYMokWLi6oYquOCRoy8f0sEQM2Uhw2x/E9tgyNoLZhDhrk805/VCsThI5fHn0YWVnmQZTrGkOwnoqLw3VHb7akUmNnjMlk/tD59bR2lgD+fnNuNsBYDDjJpg+fKmgf9araTPEIpuuanp53e6xodRYKIj4o4+39DrPK10eR4CDfSh5UShvnCZz+V0FAkIkoM92U1JTU59P4M4pzc8PswmS1rGTRaZMUrTYrjeGCHC9Hl0CTIR1/rQAx8iIcC3yVNCeiTJAmKMCl830O4GpEfduNHQgDrlsJC4q6RA7J2kUzW2WQvKFKH3bRH1hOc6LZK4DmwMGzXMKDKOxK0dzld2/ImRN6DbPacV/4d0HK06qBOFEgUJqXhMpV1JjsXVvmx/m2LCRgkD5vPEwcuiWtWde7tISLCEg6hjAV9+Hx6zOWpozg7aZMtikT+43uWakRkU/H+ITIGhqxuQhkZkmIddWrjD5lJtdUOSa0FWu969EDp4XB8dmUKSwyrkgOHZu6DutFW5ArtqhNejthWt/sV1FkSbvdd26zn1fSO4pDa4pDmcSo+l/4DChZbEyICc7IQrPjVuRUlVGuAVksZTBX+VYIip8LsJSFLHo7Dnn4QT3qDNIh8aAcY3fnHhph4G5ekbvGOw3+m1qqs8t0m89vdK7k8nJTw==";

Stimulsoft.Base.StiFontCollection.addOpentypeFontFileAsync(() => { }, "/assets/fonts/BJADIDBD.TTF");
Stimulsoft.Base.StiFontCollection.addOpentypeFontFileAsync(() => { }, "/assets/fonts/BNAZANB.TTF");
Stimulsoft.Base.StiFontCollection.addOpentypeFontFileAsync(() => { }, "/assets/fonts/BNAZANIN.TTF");
Stimulsoft.Base.StiFontCollection.addOpentypeFontFileAsync(() => { }, "/assets/fonts/BTITRBD.TTF");
Stimulsoft.Base.StiFontCollection.addOpentypeFontFileAsync(() => { }, "/assets/fonts/BYEKANo.TTF");

var reportTypes = {
    vw_irr_all_by_zone: 'vw_irr_all_by_zone',
    vw_irr_all_reqs_summary: 'vw_irr_all_reqs_summary',
    vw_irr_all_static: 'vw_irr_all_static',
    cmn_vote_issue: 'cmn_vote_issue',
    cmn77_vote_issue_preview: 'cmn77_vote_issue_preview',
    cmn_vote_issue_preview: 'cmn_vote_issue_preview',
    cmn_vote_issue_legal: 'cmn_vote_issue_legal',
    cmn_vote_issue_legal_preview: 'cmn_vote_issue_legal_preview',
    cmn_vote_issue_revision: 'cmn_vote_issue_revision',
    cmn_request: 'cmn_request',
    cmn_request_legal: 'cmn_request_legal',
    cmn_session_minute: 'cmn_session_minute',
    sup_budget_spent: 'sup_budget_spent',
    sup_budget_variance: 'sup_budget_variance',
    sup_nr_activities_mng: 'sup_nr_activities_mng',
    sup_nr_activities_zones: 'sup_nr_activities_zones',
    cmn_factor: 'cmn_factor',
    sup_hamle_ab_faza_sabz_zones: 'sup_hamle_ab_faza_sabz_zones',
    sup_hamle_ab_makhzan_zones: 'sup_hamle_ab_makhzan_zones',
    sup_hamle_ab_faza_sabz_mng: 'sup_hamle_ab_faza_sabz_mng',
    sup_hamle_ab_makhzan_mng: 'sup_hamle_ab_makhzan_mng',
    sup_agenda: 'sup_agenda',
    sup_agenda_signed: 'sup_agenda_signed',
    sup_agenda_paid: 'sup_agenda_paid',
    sup_agenda_paid_signed: 'sup_agenda_paid_signed',
    sup_monthly_assessments: 'sup_monthly_assessments',
    sup_three3month_assessments: 'sup_three3month_assessments',
    sup_three4month_assessments: 'sup_three4month_assessments',
    sup_six6month_assessments: 'sup_six6month_assessments',
    sup_six7month_assessments: 'sup_six7month_assessments',
    sup_six8month_assessments: 'sup_six8month_assessments',
    sup_temp_commission: 'sup_temp_commission',
    sup_certain_commission: 'sup_certain_commission',
    sup_certain_end_commission: 'sup_certain_end_commission',
    arbor_day_drafts: 'arbor_day_drafts',
    mlg_donor: 'mlg_donor',
    mlg_birth: 'mlg_birth',
    mlg_dead: 'mlg_dead',
    mlg_marriage: 'mlg_marriage',
    mlg_all_request_export: 'mlg_all_request_export',
    mlg_birth_copy: 'mlg_birth_copy',
    cmn_cut_tree_own: 'cmn_cut_tree_own',
    cmn_cut_tree_own_empty: 'cmn_cut_tree_own_empty',
    sup_six_month_cover: 'sup_six_month_cover',
    regions_evaluation: 'regions_evaluation',
    overal_regions_evaluation: 'overal_regions_evaluation',
    dry_danger_report: 'dry_danger_report',
    estimateMin: 'estimatemin',

    estimationTotalMin: 'estimationtotalmin',
    estimationFieldMin: 'estimationfieldmin',
    estimate: 'estimate',
    estimationTotal: 'estimationtotal',
    estimationField: 'estimationfield',
    estimateReport1232579Table1: 'estimatereport1232579table1',
    estimateReport1232579Table2: 'estimatereport1232579table2',
    estimateReport1232579Table3: 'estimatereport1232579table3',
    estimateReport1232579Table4: 'estimatereport1232579table4',
    estimateReport1232579Table1WithUpperHead: 'estimatereport1232579table1withupperhead',
    estimateReport1232579Table2WithUpperHead: 'estimatereport1232579table2withupperhead',
    estimateReport10076574TableA: 'estimatereport10076574tablea',
    estimateReport10076574TableP: 'estimatereport10076574tablep',
    sdSpeciesDraftReport: 'sdspeciesdraftreport',
    specialSdspeciesDraftReport: 'specialsdspeciesdraftreport',
    sdSpeciesInventoryChargeReport: 'sdspeciesinventorychargereport',
    supInvoiceReport: 'supinvoicereport',
    sup_invoice_and_human_report: 'sup_invoice_and_human_report',
    sup_invoice_and_human_integrated_report: 'sup_invoice_and_human_integrated_report',
    sup_invoice_report_023_169: 'sup_invoice_report_023_169',
    sup_invoice_adjustment_report_023_169: 'sup_invoice_adjustment_report_023_169',
    sup_invoice_adjustment_report: 'sup_invoice_adjustment_report',
}
var reportType = getQueryStringParam('report').toLowerCase();
$('html').addClass(reportType);

function createViewer() {


    var defer = $.Deferred();
    var deferPdf = undefined;
    // Specify necessary options for the viewer
    var options = new Stimulsoft.Viewer.StiViewerOptions();

    options.height = "100%";
    options.appearance.scrollbarsMode = true;
    options.toolbar.visible = true;
    options.toolbar.showDesignButton = false;
    options.toolbar.showOpenButton = false;
    options.toolbar.viewMode = Stimulsoft.Viewer.StiWebViewMode.Continuous;
    options.toolbar.printDestination = Stimulsoft.Viewer.StiPrintDestination.Direct;
    options.appearance.htmlRenderMode = Stimulsoft.Report.Export.StiHtmlExportMode.Table;

    // Create an instance of the viewer
    viewer = new Stimulsoft.Viewer.StiViewer(options, "StiViewer", false);

    // Add the design button event
    viewer.onDesignReport = function (e) {
        this.visible = true;

        if (designer == null)
            createDesigner();

        designer.visible = true;
        designer.report = e.report;
    };

    var report = new Stimulsoft.Report.StiReport();
    report.dictionary.databases.clear();

    if (reportType == reportTypes.vw_irr_all_by_zone)
        defer = $.get("/reports/trp/vw_irr_all_by_zone.mrt")
    else if (reportType == reportTypes.vw_irr_all_reqs_summary)
        defer = $.get("/reports/trp/vw_irr_all_reqs_summary.mrt")
    else if (reportType == reportTypes.vw_irr_all_static)
        defer = $.get("/reports/trp/vw_irr_all_static.mrt")
    else if (reportType == reportTypes.cmn_vote_issue) {
        defer = $.get("/reports/cmn/cmn_vote_issue.mrt")
        deferPdf = $.get(`/api/GeneratedTotalReport/GetByKeyGuid?key=ReqNo:${getParameterByName("requestID")}-CmnNo:${getParameterByName("commissionID")}`);
    }
    else if (reportType == reportTypes.cmn_vote_issue_preview)
        defer = $.get("/reports/cmn/cmn_vote_issue_preview.mrt")
    else if (reportType == reportTypes.cmn77_vote_issue_preview)
        defer = $.get("/reports/cmn/cmn_vote_issue.mrt")
    else if (reportType == reportTypes.cmn_vote_issue_revision)
        defer = $.get("/reports/cmn/cmn_vote_issue_revision.mrt")
    else if (reportType == reportTypes.cmn_vote_issue_legal_preview)
        defer = $.get("/reports/cmn/cmn_vote_issue_legal_preview.mrt")
    else if (reportType == reportTypes.cmn_vote_issue_legal)
        defer = $.get("/reports/cmn/cmn_vote_issue_legal.mrt")
    else if (reportType == reportTypes.cmn_factor)
        defer = $.get("/reports/cmn/cmn_factor.mrt")
    else if (reportType == reportTypes.cmn_request)
        defer = $.get("/reports/cmn/cmn_request.mrt")
    else if (reportType == reportTypes.cmn_request_legal)
        defer = $.get("/reports/cmn/cmn_request_legal.mrt")
    else if (reportType == reportTypes.cmn_session_minute)
        defer = $.get("/reports/cmn/cmn_session_minute.mrt")
    else if (reportType == reportTypes.sup_budget_spent)
        defer = $.get("/reports/sup/sup_budget_spent.mrt")
    else if (reportType == reportTypes.sup_budget_variance)
        defer = $.get("/reports/sup/sup_budget_variance.mrt")
    else if (reportType == reportTypes.sup_nr_activities_mng)
        defer = $.get("/reports/sup/sup_nr_activities_mng.mrt")
    else if (reportType == reportTypes.sup_nr_activities_zones)
        defer = $.get("/reports/sup/sup_nr_activities_zones.mrt")
    else if (reportType == reportTypes.sup_hamle_ab_faza_sabz_zones)
        defer = $.get("/reports/sup/sup_hamle_ab_faza_sabz_zones.mrt")
    else if (reportType == reportTypes.sup_hamle_ab_makhzan_zones)
        defer = $.get("/reports/sup/sup_hamle_ab_makhzan_zones.mrt")
    else if (reportType == reportTypes.sup_hamle_ab_faza_sabz_mng)
        defer = $.get("/reports/sup/sup_hamle_ab_faza_sabz_mng.mrt")
    else if (reportType == reportTypes.sup_hamle_ab_makhzan_mng)
        defer = $.get("/reports/sup/sup_hamle_ab_makhzan_mng.mrt")
    else if (reportType == reportTypes.sup_agenda)
        defer = $.get("/reports/sup/sup_agenda.mrt")
    else if (reportType == reportTypes.sup_agenda_signed)
        defer = $.get("/reports/sup/sup_agenda_signed.mrt")
    else if (reportType == reportTypes.sup_agenda_paid)
        defer = $.get("/reports/sup/sup_agenda_paid.mrt")
    else if (reportType == reportTypes.sup_agenda_paid_signed)
        defer = $.get("/reports/sup/sup_agenda_paid_signed.mrt")
    else if (reportType == reportTypes.sup_monthly_assessments)
        defer = $.get("/reports/sup/sup_monthly_assessments.mrt")
    else if (reportType == reportTypes.sup_three3month_assessments)
        defer = $.get("/reports/sup/sup_three3month_assessments.mrt")
    else if (reportType == reportTypes.sup_three4month_assessments)
        defer = $.get("/reports/sup/sup_three4month_assessments.mrt")
    else if (reportType == reportTypes.sup_six6month_assessments)
        defer = $.get("/reports/sup/sup_six6month_assessments.mrt")
    else if (reportType == reportTypes.sup_six7month_assessments)
        defer = $.get("/reports/sup/sup_six7month_assessments.mrt")
    else if (reportType == reportTypes.sup_six8month_assessments)
        defer = $.get("/reports/sup/sup_six8month_assessments.mrt")

    else if (reportType == reportTypes.sup_six_month_cover)
        defer = $.get("/reports/sup/sup_six_month_cover.mrt")

    else if (reportType == reportTypes.regions_evaluation)
        defer = $.get("/reports/RGNEvaluation/regions_evaluation.mrt")

    else if (reportType == reportTypes.overal_regions_evaluation)
        defer = $.get("/reports/RGNEvaluation/overal_regions_evaluation.mrt")

    else if (reportType == reportTypes.sup_temp_commission)
        defer = $.get("/reports/sup/sup_temp_commission.mrt")
    else if (reportType == reportTypes.sup_certain_commission)
        defer = $.get("/reports/sup/sup_certain_commission.mrt")
    else if (reportType == reportTypes.sup_certain_end_commission)
        defer = $.get("/reports/sup/sup_certain_end_commission.mrt")

    else if (reportType == reportTypes.arbor_day_drafts)
        defer = $.get("/reports/arborDay/arbor_day_drafts.mrt")
    else if (reportType == reportTypes.mlg_donor)
        defer = $.get("/reports/MLG/mlg_donor.mrt")
    else if (reportType == reportTypes.mlg_birth)
        defer = $.get("/reports/MLG/mlg_birth.mrt")
    else if (reportType == reportTypes.mlg_dead)
        defer = $.get("/reports/MLG/mlg_dead.mrt")
    else if (reportType == reportTypes.mlg_marriage)
        defer = $.get("/reports/MLG/mlg_marriage.mrt")
    else if (reportType == reportTypes.mlg_all_request_export)
        defer = $.get("/reports/MLG/mlg_all_request_export.mrt")
    else if (reportType == reportTypes.mlg_birth_copy)
        defer = $.get("/reports/MLG/mlg_birth_copy.mrt")
    else if (reportType == reportTypes.cmn_cut_tree_own)
        defer = $.get("/reports/CMN/cmn_cut_tree_own_test.mrt")
    else if (reportType == reportTypes.cmn_cut_tree_own_empty)
        defer = $.get("/reports/CMN/cmn_cut_tree_own_test _empty.mrt")
    else if (reportType == reportTypes.dry_danger_report) {

        defer = $.get("/reports/DryDanger/dry_danger_report.mrt")
    }
    else if (reportType == reportTypes.estimateMin)
        defer = $.get("/reports/estimates/EstimationMin.mrt")

    else if (reportType == reportTypes.estimationTotalMin)
        defer = $.get("/reports/estimates/EstimationTotalMin.mrt")
    else if (reportType == reportTypes.estimationFieldMin)
        defer = $.get("/reports/estimates/EstimationFieldMin.mrt")
    else if (reportType == reportTypes.estimate)
        defer = $.get("/reports/estimates/Estimation.mrt")
    else if (reportType == reportTypes.estimationTotal)
        defer = $.get("/reports/estimates/EstimationTotal.mrt")
    else if (reportType == reportTypes.estimationField)
        defer = $.get("/reports/estimates/EstimationField.mrt")
    else if (reportType == reportTypes.estimateReport1232579Table1 || reportType == reportTypes.estimateReport1232579Table1WithUpperHead)
        defer = $.get("/reports/estimates/1232579-96-table1.mrt")
    else if (reportType == reportTypes.estimateReport1232579Table2 || reportType == reportTypes.estimateReport1232579Table2WithUpperHead)
        defer = $.get("/reports/estimates/1232579-96-table2.mrt")
    else if (reportType == reportTypes.estimateReport1232579Table3)
        defer = $.get("/reports/estimates/1232579-96-table3.mrt")
    else if (reportType == reportTypes.estimateReport1232579Table4)
        defer = $.get("/reports/estimates/1232579-96-table4.mrt")
    else if (reportType == reportTypes.estimateReport10076574TableA)
        defer = $.get("/reports/estimates/report_100_76574_A.mrt")
    else if (reportType == reportTypes.estimateReport10076574TableP)
        defer = $.get("/reports/estimates/report_100_76574_P.mrt")
    else if (reportType == reportTypes.sdSpeciesDraftReport)
        defer = $.get("/reports/speciesDistribution/Draft.mrt")
    else if (reportType == reportTypes.specialSdspeciesDraftReport)
        defer = $.get("/reports/speciesDistribution/Draft.mrt")
    else if (reportType == reportTypes.sdSpeciesInventoryChargeReport)
        defer = $.get("/reports/speciesDistribution/InventoryCharge.mrt")
    else if (reportType == reportTypes.supInvoiceReport)
        defer = $.get("/reports/supervision/invoices/InvoiceReport.mrt")

    else if (reportType == reportTypes.sup_invoice_and_human_report)
        defer = $.get("/reports/supervision/invoices/sup_invoice_and_human_report.mrt")


    else if (reportType == reportTypes.sup_invoice_and_human_integrated_report)
        defer = $.get("/reports/supervision/invoices/sup_invoice_and_human_integrated_report.mrt")
    else if (reportType == reportTypes.sup_invoice_report_023_169)
        defer = $.get("/reports/supervision/invoices/InvoiceReport_023_169.mrt")
    else if (reportType == reportTypes.sup_invoice_adjustment_report_023_169)
        defer = $.get("/reports/supervision/adjustmentInvoice/InvoiceReport_023_169.mrt")
    else if (reportType == reportTypes.sup_invoice_adjustment_report)
        defer = $.get("/reports/supervision/adjustmentInvoice/InvoiceReport.mrt")


    //      defer = $.get("/reports/sup/sup_agenda.mrt")
    else {

        window.location = '/';
        return;
    }




    if (deferPdf) {

        deferPdf.then(res => {


            if (res && res.success) {



                window.open(`${window.origin}${res.data.fileNameFull}`, '_self')
            } else {

                defer.then((res) => {
                    report.load(res);

                    setReport(report, reportType)
                        .then(function () {
                            viewer.report = report;
                            viewer.renderHtml("viewerContent");
                        });
                });
            }
        });
    } else {

        defer.then((res) => {
            report.load(res);

            setReport(report, reportType)
                .then(function () {
                    viewer.report = report;
                    viewer.renderHtml("viewerContent");
                });
        });

    }

}

function setReport(report, reportType) {


    var defer = undefined;
    deferFooterInfo = undefined;


    deferFooterInfo = $.get('/api/SharedTasks/GetFooterInfo')

    if (reportType == reportTypes.vw_irr_all_by_zone) {
        defer = $.post("/api/IrrigationAllByZone/Get?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.vw_irr_all_reqs_summary) {
        defer = $.post("/api/IrrigationAllRequestsSummary/Get?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.vw_irr_all_static) {
        defer = $.post("/api/IrrigationAllStatic/GetForPrint?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.cmn_vote_issue
        || reportType == reportTypes.cmn_vote_issue_preview
        || reportType == reportTypes.cmn77_vote_issue_preview
        || reportType == reportTypes.cmn_vote_issue_legal
        || reportType == reportTypes.cmn_vote_issue_revision
        || reportType == reportTypes.cmn_vote_issue_legal_preview
    ) {
        defer = $.post("/api/CommissionVoteReport/Get?requestID=" + getParameterByName("requestID") +
            "&commissionID=" + getParameterByName("commissionID")
        );


    }
    else if (reportType == reportTypes.cmn_factor) {
        defer.resolve([{ data: [] }]);
    }
    else if (reportType == reportTypes.cmn_request) {
        defer = $.get("/api/CommissionReports/GetRequest?requestID=" + getParameterByName("requestID"));
    }
    else if (reportType == reportTypes.cmn_request_legal) {
        defer = $.get("/api/CommissionReports/GetRequest?requestID=" + getParameterByName("requestID"));
    }
    else if (reportType == reportTypes.cmn_session_minute) {
        defer = $.get("/api/CommissionSessionReport/GetSessionRequests?sessionID=" + getParameterByName("id"));
    }

    else if (reportType == reportTypes.sup_six_month_cover) {
        defer = $.get("/api/SupSixMonthCover/GetByInstanceGuid?instanceGuid=" + getParameterByName("instanceGuid"));
    }
    else if (reportType == reportTypes.regions_evaluation) {
        defer = $.get("/api/RegionsPreformanceEvaluation/GetByInstanceGuid?guid=" + getParameterByName("instanceguid"));
    }

    else if (reportType == reportTypes.overal_regions_evaluation) {
        defer = $.get("/api/RegionsPreformanceEvaluation/Get?yearId=" + getParameterByName("yearId") + "&monthId=" + getParameterByName("monthId"));
    }



    else if (reportType == reportTypes.sup_budget_spent) {
        defer = $.post("/api/BudgetSpent/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.sup_budget_variance) {
        defer = $.post("/api/BudgetVariance/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.sup_nr_activities_mng) {
        defer = $.post("/api/NrActivitiesMng/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.sup_nr_activities_zones) {
        defer = $.post("/api/NrActivitiesZones/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.sup_hamle_ab_faza_sabz_zones) {
        defer = $.post("/api/HamleAbFazaSabzZones/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.sup_hamle_ab_makhzan_zones) {
        defer = $.post("/api/HamleAbMakhzanZones/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.sup_hamle_ab_faza_sabz_mng) {
        defer = $.post("/api/HamleAbFazaSabzMng/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }
    else if (reportType == reportTypes.sup_hamle_ab_makhzan_mng) {
        defer = $.post("/api/HamleAbMakhzanMng/GetReportData?", {
            pageIndex: getParameterByName("pageIndex"),
            pageSize: getParameterByName("pageSize"),
            pageOrder: getParameterByName("pageOrder"),
            filters: getParameterByName("filters")
        });
    }

    else if (reportType == reportTypes.sup_agenda) {

        defer = $.get("/api/OrderedActivity/GetByInstanceGuid?instanceGuid=" + getParameterByName("requestID"));
    }
    else if (reportType == reportTypes.sup_agenda_signed) {

        defer = $.get("/api/OrderedActivity/GetByInstanceGuid?instanceGuid=" + getParameterByName("requestID"));
    }
    else if (reportType == reportTypes.sup_agenda_paid) {

        defer = $.get("/api/OrderedActivity/GetByInstanceGuid?instanceGuid=" + getParameterByName("requestID"));
    }
    else if (reportType == reportTypes.sup_agenda_paid_signed) {

        defer = $.get("/api/OrderedActivity/GetByInstanceGuid?instanceGuid=" + getParameterByName("requestID"));
    }

    else if (reportType == reportTypes.sup_monthly_assessments ||
        reportType == reportTypes.sup_three3month_assessments ||
        reportType == reportTypes.sup_three4month_assessments ||
        reportType == reportTypes.sup_six6month_assessments ||
        reportType == reportTypes.sup_six7month_assessments ||
        reportType == reportTypes.sup_six8month_assessments
    ) {
        defer = $.get("/api/Assessment/GetByGuid?guid=" + getParameterByName("guid"));
    }

    else if (reportType == reportTypes.sup_temp_commission ||
        reportType == reportTypes.sup_certain_commission ||
        reportType == reportTypes.sup_certain_end_commission


    ) {

        defer = $.get("/api/SupCommission/GetRequestByID?requestID=" + getParameterByName("requestID"));
    }
    else if (reportType == reportTypes.arbor_day_drafts) {
        defer = $.get("/api/ArborDayDraft/GetInfoByGuidID?guid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateMin || reportType == reportTypes.estimate) {
        defer = $.get("/api/EstimateReport/GetEstimateDetail?instanceGuid=" + getParameterByName("guid"));
    }

    else if (reportType == reportTypes.estimationTotalMin) {
        defer = $.get("/api/EstimateReport/GetEstimateTotalMin?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimationFieldMin) {
        defer = $.get("/api/EstimateReport/GetEstimateFieldMin?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimationField) {
        defer = $.get("/api/EstimateReport/GetEstimateField?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateReport1232579Table1) {
        defer = $.get("/api/EstimateReport/Report1232579Table1?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateReport1232579Table2) {
        defer = $.get("/api/EstimateReport/Report1232579Table2?instanceGuid=" + getParameterByName("guid") + "&thresholdPercent=" + getParameterByName("thresholdPercent"));
    }
    else if (reportType == reportTypes.estimateReport1232579Table3) {
        defer = $.get("/api/EstimateReport/Report1232579Table3?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateReport1232579Table4) {
        defer = $.get("/api/EstimateReport/Report1232579Table4?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateReport1232579Table1WithUpperHead) {
        defer = $.get("/api/EstimateReport/Report1232579Table1WithUpperHeadCoeff?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateReport1232579Table2WithUpperHead) {
        defer = $.get("/api/EstimateReport/Report1232579Table2WithUpperHeadCoeff?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateReport10076574TableA) {
        defer = $.get("/api/EstimateReport/Report10076574TableA?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimateReport10076574TableP) {
        defer = $.get("/api/EstimateReport/Report10076574TableP?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.estimationTotal) {
        defer = $.get("/api/EstimateReport/GetEstimationSeason?instanceGuid=" + getParameterByName("guid"));
    }
    else if (reportType == reportTypes.mlg_donor ||
        reportType == reportTypes.mlg_birth ||
        reportType == reportTypes.mlg_dead ||
        reportType == reportTypes.mlg_marriage ||
        reportType == reportTypes.mlg_birth_copy
    ) {
        defer = $.get("/api/MlgRequest/GetByInstanceGuid?instanceGuid=" + getParameterByName("instanceGuid"));
    }
    else if (reportType == reportTypes.cmn_cut_tree_own) {
        defer = $.get("/api/CommissionCutTreeOwn/GetByInstanceGuid?instanceGuid=" + getParameterByName("instanceGuid"));
    }
    else if (reportType == reportTypes.cmn_cut_tree_own_empty) {
        defer = $.get("/api/CommissionCutTreeOwn/GetByInstanceGuid?instanceGuid=" + getParameterByName("instanceGuid"));
    }
    else if (reportType == reportTypes.dry_danger_report) {

        defer = $.post("/api/DryDangerRequest/GetByInstanceGuid?instanceGuid=" + getParameterByName('guid'));
    }
    else if (reportType == reportTypes.mlg_all_request_export) {
        defer = $.post("/api/MlgAllRequestsExport/Export", {
            guids: getParameterByName("guids")
        });
    }
    else if (reportType == reportTypes.sdSpeciesDraftReport) {
        defer = $.get("/api/SdSpeciesDrafts/GetDraftReport?instanceGuid=" + getParameterByName('guid'));
    }
    else if (reportType == reportTypes.specialSdspeciesDraftReport) {
        defer = $.get("/api/SdSpeciesDrafts/GetDraftReport?instanceGuid=" + getParameterByInstance());
    }
    else if (reportType == reportTypes.sdSpeciesInventoryChargeReport) {
        defer = $.get("/api/SdSpeciesInventoryChargeRequest/GetInventoryChargeReport?instanceGuid=" + getParameterByInstance());
    }
    else if (reportType == reportTypes.supInvoiceReport) {
        defer = $.get("/api/SupInvoice/GetSupInvoiceReportByInstanceGuid?instanceGuid=" + getParameterByName('guid'));
    }
    else if (reportType == reportTypes.sup_invoice_and_human_report) {
        defer = $.get("/api/SupInvoice/GetSupInvoiceReportAndHumanByInstanceGuid?instanceGuid=" + getParameterByName('guid'));
    }

    else if (reportType == reportTypes.sup_invoice_and_human_integrated_report) {
        defer = $.get("/api/SupInvoice/GetSupInvoiceReportAndHumanByInstanceGuid?instanceGuid=" + getParameterByName('guid'));
    }
    else if (reportType == reportTypes.sup_invoice_report_023_169) {
        defer = $.get("/api/SupInvoice/GetSupInvoiceReportByInstanceGuid?instanceGuid=" + getParameterByName('guid'));
    }
    else if (reportType == reportTypes.sup_invoice_adjustment_report_023_169 || reportType == reportTypes.sup_invoice_adjustment_report) {
        defer = $.get("/api/SupInvoiceAdjustment/GetReportByInstanceGuid?instanceGuid=" + getParameterByName('guid'));
    }
    else {
        setTimeout(function () {
            defer.resolve();
        });
    }

    return $.when(defer, deferFooterInfo)
        .then(function (resData, resFooterInfo) {

            var result = resData[0].data;
            var footerInfo = resFooterInfo[0].data;

            if (reportType == reportTypes.vw_irr_all_by_zone) {
                report.regData("Datasource", "Datasource", replaceYeKe(result.rows));
            }
            else if (reportType == reportTypes.vw_irr_all_reqs_summary) {
                report.regData("Datasource", "Datasource", replaceYeKe(result.rows));
            }
            else if (reportType == reportTypes.vw_irr_all_static) {
                report.regData("Datasource", "Datasource", replaceYeKe(result.data.rows));
                report.setVariable('reportDesc', replaceYeKe(result.reportDescription));
            }
            else if (reportType == reportTypes.sup_six_month_cover) {
                report.setVariable('reportNo', result.reportNo);
                report.setVariable('contractorCeo', result.contractorCeo);

                report.setVariable('guid', replaceYeKe(result.guid));
                report.setVariable('provider', replaceYeKe(result.provider));
                report.setVariable('contractNo', replaceYeKe(result.contractNo));
                report.setVariable('titleOfContract', replaceYeKe(result.titleOfContract));
                report.setVariable('nazerMoghimFullname', replaceYeKe(result.nazerMoghimFullname));
                report.setVariable('bosssabzFullname', replaceYeKe(result.bosssabzFullname));
                report.setVariable('karfarma', replaceYeKe(result.karfarma));
                report.setVariable('contractorCode', replaceYeKe(result.contractorCode));
                report.setVariable('nazerScore', parseFloat(result.nazerMoghimScore));
                report.setVariable('behbudSignature', result.behbudSignature);

                report.setVariable('sabzScore', parseFloat(result.bosssabzScore));
                report.setVariable('mantScore', parseFloat(result.municipalScore));
                report.setVariable('behbudScore', parseFloat(result.behbudScore));
                report.setVariable('herasatScore', parseFloat(result.herasatScore));
                report.setVariable('percentageBidPrice', result.percentageBidPrice);
                report.setVariable('finalscore', parseFloat(result.finalscore));
                report.setVariable('municipalSignature', replaceYeKe(result.municipalSignature));
                report.setVariable('bosssabzSignature', replaceYeKe(result.bosssabzSignature));
                report.setVariable('nazerMoghimSignature', replaceYeKe(result.nazerMoghimSignature));
                report.setVariable('herasatSignature', replaceYeKe(result.herasatSignature));
                report.setVariable('municipalFullname', replaceYeKe(result.municipalFullname));
                report.setVariable('herasatSignature', replaceYeKe(result.herasatSignature));
                report.setVariable('herasatFullname', replaceYeKe(result.herasatFullname));
                report.setVariable('behbudFullname', replaceYeKe(result.behbudFullname));
                report.setVariable('contractPrimaryDuration', replaceYeKe(result.contractPrimaryDuration));
                report.setVariable('startDatePersian', replaceYeKe(result.startDatePersian));
                report.setVariable('endDatePersian', replaceYeKe(result.endDatePersian));
                report.setVariable('reportDatePersian', replaceYeKe(result.reportDatePersian));
                report.setVariable('contractPrimaryPrice', replaceYeKe(result.contractPrimaryPrice));
                report.setVariable('finalPriceContract', replaceYeKe(result.finalPriceContract));
                report.setVariable('plusOrMinus', replaceYeKe(result.plusOrMinus));
                report.setVariable('zoneName', replaceYeKe(result.zoneName));
                report.setVariable('zoneCode', replaceYeKe(result.zoneCode));
                report.setVariable('schedulePrices', replaceYeKe(result.schedulePrices));
            }

            else if (reportType == reportTypes.cmn_vote_issue
                || reportType == reportTypes.cmn_vote_issue_preview
                || reportType == reportTypes.cmn77_vote_issue_preview
                || reportType == reportTypes.cmn_vote_issue_legal
                || reportType == reportTypes.cmn_vote_issue_legal_preview
                || reportType == reportTypes.cmn_vote_issue_revision
            ) {
                report.regData("Datasource", "Datasource", replaceYeKe(result.data.rows));
                report.setVariable('cmn_cc_before_payment', replaceYeKe(result.replicantsBeforePayment));
                report.setVariable('cmn_cc_after_payment', replaceYeKe(result.replicantsAfterPayment));
                report.setVariable('cmn_voteType', !result.isViolation ? 'تقاضا' : 'غیر تقاضا');
                report.setVariable('cmn_isRevision', result.isRevision ? 'مجدد' : '');
                report.setVariable('cmn_requestNo', replaceYeKe(result.requestNo));

                report.setVariable('cmn_carname', replaceYeKe(result.carName));
                report.setVariable('cmn_carmodelname', replaceYeKe(result.carModelName));
                report.setVariable('cmn_accidentaddress', replaceYeKe(result.accidentAddress));
                report.setVariable('cmn_policletterno', replaceYeKe(result.policeLetterNo));
                report.setVariable('cmn_carplaque', replaceYeKe(result.carPlaque));

                report.setVariable('cmn_incomeToCommissionDate', replaceYeKe(result.incomeToCommissionDate));
                report.setVariable('cmn_requestDate', replaceYeKe(result.requestDate));
                report.setVariable('cmn_dabirDate', replaceYeKe(result.incomeToCommissionDate));
                report.setVariable('cmn_sessionDate', replaceYeKe(result.sessionDate));
                report.setVariable('cmn_sessionNumber', replaceYeKe(result.sessionNumber));
                report.setVariable('cmn_voteDate', replaceYeKe(result.voteDate));
                report.setVariable('cmn_sendVoteDate', replaceYeKe(result.sendVoteDate));
                report.setVariable('cmn_userFullName', replaceYeKe(result.userFullName));
                report.setVariable('cmn_muniOrganTitle', replaceYeKe(result.muniOrganTitle));
                report.setVariable('cmn_projectName', replaceYeKe(result.projectName));
                report.setVariable('cmn_nationalCode', replaceYeKe(result.nationalCode));
                report.setVariable('cmn_mobile', replaceYeKe(result.mobile));
                report.setVariable('cmn_zone', replaceYeKe(result.zone));
                report.setVariable('cmn_region', replaceYeKe(result.region));
                report.setVariable('cmn_sdiCode', replaceYeKe(result.sdiCode));
                report.setVariable('cmn_address', replaceYeKe(result.address));
                report.setVariable('cmn_ownerMessage', replaceYeKe(result.ownerMessage));
                report.setVariable('cmn_penaltyPaidConfirmationText', replaceYeKe(result.penaltyPaidConfirmationText));
                report.setVariable('cmn_unlockDescription', replaceYeKe(result.unlockDescription));
                report.setVariable('cmn_freeup', replaceYeKe(result.freeup));
                report.setVariable('cmn_freeupSdiCode', replaceYeKe(result.freeupSdiCode));
                report.setVariable('cmn_freeupPrice', replaceYeKe(result.freeupPrice));
                report.setVariable('cmn_unlockText', replaceYeKe(result.unlockText));
                report.setVariable('cmn_actText', replaceYeKe(result.actText));
                report.setVariable('cmn_extraPaymentSentences', replaceYeKe(result.extraPaymentSentences));

                report.setVariable('cmn_isPaymentConfirmedByDabir', replaceYeKe(result.isPaymentConfirmedByDabir));
                report.setVariable('signituresNames', replaceYeKe(result.commissioVoteSignitures.map(r => r.roleName + "\n" + r.fullName)));
                if (reportType != reportTypes.cmn_vote_issue_preview)
                    report.setVariable('signituresPaths', result.commissioVoteSignitures.map(r => r.signiturePath));
                report.setVariable('cmn_foreignCommissionVote', replaceYeKe(result.foreignCommissionVote));
                if (reportType == reportTypes.cmn77_vote_issue_preview)
                    report.setVariable('isPriview', true);

            }
            else if (reportType == reportTypes.cmn_factor) {
                report.regData("ds", "ds", replaceYeKe([{ id: 1 }, { id: 2 }, { id: 3 }, { id: 4 }]));
            }
            else if (reportType == reportTypes.cmn_session_minute) {
                var data = {
                    Datasource: replaceYeKe(result.requests),
                    VoteDetail: result.votes
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
                report.setVariable('sessionNumber', result.sessionInfo.sessionNumber);
                report.setVariable('sessionSubject', result.sessionInfo.title);
                report.setVariable('sessionDate', result.sessionInfo.persianDate);
                report.setVariable('signituresNames', replaceYeKe(result.commissionVoteSignitures.map(r => r.roleName + "\n" + r.fullName)));
                report.setVariable('signituresPaths', result.commissionVoteSignitures.map(r => r.signiturePath));
            }
            else if (reportType == reportTypes.cmn_request || reportType == reportTypes.cmn_request_legal) {
                var requestInfo = result.requestInfo,
                    cityInfoHeader = result.cityInfoHeader,
                    cityInfoArchive = [],//result.cityInfoArchive.rows,
                    cityInfoEdges = result.cityInfoEdges.rows,
                    cityInfoFront = result.cityInfoFront.rows,
                    cityInfoUsing = result.cityInfoUsing.rows,
                    visit1violations = result.visit1Violations ? result.visit1Violations.rows : [],
                    visit2violations = result.visit2Violations ? result.visit2Violations.rows : [],
                    visit1Status = result.visit1Status ? result.visit1Status.rows : [],
                    visit2Status = result.visit2Status ? result.visit2Status.rows : [],
                    referrals = result.referrals,
                    vote = result.vote || {
                        data: { rows: [] }
                    },
                    visitDetail1Images = (result.visitDetail1Images || []).concat((requestInfo.visit1 || {}).visitDetailAttachments || []),
                    visitDetail2Images = (result.visitDetail2Images || []).concat((requestInfo.visit2 || {}).visitDetailAttachments || []);

                if (requestInfo.visit1) {
                    requestInfo.visit1.isCorner = requestInfo.visit1.isCorner ? "بله" : "خیر";
                    if (requestInfo.visit1.attachments)
                        requestInfo.visit1.attachments.forEach(function (item) {
                            item.fileName = normalizeImagePath(item.fileName)
                        });
                }
                if (requestInfo.visit2) {
                    requestInfo.visit2.isCorner = requestInfo.visit2.isCorner ? "بله" : "خیر";
                    if (requestInfo.visit2.attachments)
                        requestInfo.visit2.attachments.forEach(function (item) {
                            item.fileName = normalizeImagePath(item.fileName)
                        });
                }
                if (requestInfo.attachments) {
                    requestInfo.attachments.forEach(function (item) {
                        item.fileName = normalizeImagePath(item.fileName)
                    });
                }

                if (visitDetail1Images)
                    visitDetail1Images.forEach(function (item) {
                        item.fileName = normalizeImagePath(item.fileName)
                    });

                if (visitDetail2Images)
                    visitDetail2Images.forEach(function (item) {
                        item.fileName = normalizeImagePath(item.fileName)
                    });

                var data = {
                    vote: replaceYeKe(vote.data.rows),
                    cityInfoHeader: [cityInfoHeader],
                    cityInfoArchive: [], //cityInfoArchive,
                    cityInfoFront: cityInfoFront,
                    cityInfoEdges: cityInfoEdges,
                    cityInfoUsing: cityInfoUsing,
                    requestedTrees: reportType == reportTypes.cmn_request_legal ? replaceYeKe(requestInfo.requestAttachments) : replaceYeKe(requestInfo.requestedTrees),
                    visit1header: requestInfo.visit1 ? [requestInfo.visit1] : [],
                    visit1directions: requestInfo.visit1 ? (requestInfo.visit1.directions ? requestInfo.visit1.directions.rows : []) : [],
                    visit1floors: requestInfo.visit1 ? (requestInfo.visit1.floors ? requestInfo.visit1.floors.rows : []) : [],
                    visit2header: requestInfo.visit2 ? [requestInfo.visit2] : [],
                    visit2directions: requestInfo.visit2 ? (requestInfo.visit2.directions ? requestInfo.visit2.directions.rows : []) : [],
                    visit2floors: requestInfo.visit2 ? (requestInfo.visit2.floors ? requestInfo.visit2.floors.rows : []) : [],
                    visit2internalInquiries: requestInfo.visit2 ? requestInfo.visit2.internalInquiries : [],
                    visit2externalInquiries: requestInfo.visit2 ? requestInfo.visit2.externalInquiries : [],
                    visit1details: requestInfo.visit1 ? (requestInfo.visit1.visitDetails ? requestInfo.visit1.visitDetails.rows : []) : [],
                    visit1violations: visit1violations,
                    visit1plantStatus: visit1Status,
                    visit2details: requestInfo.visit2 ? (requestInfo.visit2.visitDetails ? requestInfo.visit2.visitDetails.rows : []) : [],
                    visit2violations: visit2violations,
                    visit2plantStatus: visit2Status,
                    reqAttachments: requestInfo.attachments,
                    visit1attachments: requestInfo.visit1 ? requestInfo.visit1.attachments : [],
                    visit2attachments: requestInfo.visit2 ? requestInfo.visit2.attachments : [],
                    visitDetail1Images: visitDetail1Images || [],
                    visitDetail2Images: visitDetail2Images || [],
                    referrals: referrals,
                    internalInquiriesFiles: [],
                    externalInquiriesFiles: [],
                }

                data.requestedTrees.forEach(function (item) {
                    if (item.imagePath == '')
                        item.imagePath = null;

                    if (item.imagePath || item.fileName)
                        item.imagePath = normalizeImagePath(item.imagePath || item.fileName)
                });

                data.visit2internalInquiries.forEach(function (inq) {
                    if (!inq.attachments)
                        return;
                    inq.attachments.forEach(function (item) {
                        if (item.fileName == '')
                            item.fileName = null;

                        if (item.fileName) {
                            item.fileName = normalizeImagePath(item.fileName)
                            data.internalInquiriesFiles.push({ fileName: item.fileName, description: inq.organizationName })
                        }
                    });
                });


                data.visit2externalInquiries.forEach(function (inq) {
                    if (!inq.attachments)
                        return;
                    inq.attachments.forEach(function (item) {
                        if (item.fileName == '')
                            item.fileName = null;

                        if (item.fileName) {
                            item.fileName = normalizeImagePath(item.fileName)
                            data.externalInquiriesFiles.push({ fileName: item.fileName, description: inq.organizationName })
                        }
                    });
                });

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);

                report.setVariable('page_visit1Enable', data.visit1header.length > 0);
                report.setVariable('page_visit2Enable', data.visit2header.length > 0);
                report.setVariable('page_voteEnable', data.vote.length > 0);
                report.setVariable('page_attachments',
                    (data.visitDetail1Images && data.visitDetail1Images.length > 0)
                    || (data.visitDetail12mages && data.visitDetail12mages.length > 0)
                    || (data.reqAttachments && data.reqAttachments.length > 0)
                    || (data.visit1attachments && data.visit1attachments.length > 0)
                    || (data.visit2attachments && data.visit2attachments.length > 0)
                    || (data.internalInquiriesFiles && data.internalInquiriesFiles.length > 0)
                    || (data.externalInquiriesFiles && data.externalInquiriesFiles.length > 0)
                );

                report.setVariable('cmn_voteType', !requestInfo.isViolation ? 'تقاضا' : 'تخلف');
                report.setVariable('cmn_isRevision', requestInfo.isRevision ? 'مجدد' : '');
                report.setVariable('req_zone', replaceYeKe(requestInfo.zoneTitle));
                report.setVariable('req_region', replaceYeKe(requestInfo.regionTitle));
                report.setVariable('req_isViolation', replaceYeKe(requestInfo.isViolation));
                report.setVariable('req_sdiCode', replaceYeKe(requestInfo.sdiCode));
                report.setVariable('req_address', replaceYeKe(requestInfo.address));
                report.setVariable('req_requestNo', replaceYeKe(requestInfo.code));
                report.setVariable('req_requestDate', replaceYeKe(requestInfo.createdOnPersian));
                report.setVariable('req_phone', replaceYeKe(requestInfo.phoneNo));
                report.setVariable('req_mobile', replaceYeKe(requestInfo.mobileNo));
                report.setVariable('req_estate_status', replaceYeKe(requestInfo.esetStatusTitle));
                report.setVariable('req_postalCode', replaceYeKe(requestInfo.postCode));
                report.setVariable('req_email', replaceYeKe(requestInfo.email));
                report.setVariable('req_sdiAddress', replaceYeKe(requestInfo.sdiAddress));
                report.setVariable('req_fullname', replaceYeKe(requestInfo.firstname + ' ' + requestInfo.lastname));
                report.setVariable('req_nationalCode', replaceYeKe(requestInfo.nationalCode));
                report.setVariable('req_treesCount', replaceYeKe(requestInfo.requestedTreesCount));
                report.setVariable('req_requestedTreesDescription', replaceYeKe(requestInfo.requestedTreesDescription));
                report.setVariable('req_ownerName', replaceYeKe(requestInfo.ownerName));
                report.setVariable('req_projectArea', replaceYeKe(requestInfo.projectArea));
                report.setVariable('req_usageTitle', replaceYeKe(requestInfo.usageTitle));
                report.setVariable('req_muniOrganTitle', replaceYeKe(requestInfo.muniOrganTitle));
                report.setVariable('req_projectName', replaceYeKe(requestInfo.projectName));
                report.setVariable('req_managerName', replaceYeKe(requestInfo.managerName));
                report.setVariable('req_applicantName', replaceYeKe(requestInfo.applicantName));
                report.setVariable('req_ownerNationCode', replaceYeKe(requestInfo.ownerNationCode));
                report.setVariable('req_landArea', replaceYeKe(requestInfo.landArea));
                report.setVariable('req_superstructureArea', replaceYeKe(requestInfo.superstructureArea));
                report.setVariable('req_needDestruction', requestInfo.needDestruction ? 'بله' : 'خیر');
                report.setVariable('req_alreadyRequested', requestInfo.alreadyRequested ? 'بله' : 'خیر');
                report.setVariable('isMuni', requestInfo.commissionRequestType == 3 || requestInfo.commissionRequestType == 5 ? '1' : '0');

                report.setVariable('cmn_cc', replaceYeKe(vote.replicants));
                report.setVariable('cmn_requestNo', replaceYeKe(vote.requestNo));
                report.setVariable('cmn_requestDate', replaceYeKe(vote.requestDate));
                report.setVariable('cmn_dabirDate', replaceYeKe(result.dabirDate));
                report.setVariable('cmn_sessionDate', replaceYeKe(result.sessionDate));
                report.setVariable('cmn_sessionNumber', replaceYeKe(result.sessionNumber));
                report.setVariable('cmn_voteDate', replaceYeKe(vote.voteDate));
                report.setVariable('cmn_sendVoteDate', replaceYeKe(vote.sendVoteDate));
                report.setVariable('cmn_userFullName', replaceYeKe(vote.userFullName));
                report.setVariable('cmn_nationalCode', replaceYeKe(vote.nationalCode));
                /*report.setVariable('cmn_mobile', replaceYeKe(vote.mobile));*/
                report.setVariable('cmn_zone', replaceYeKe(vote.zone));
                report.setVariable('cmn_region', replaceYeKe(vote.region));
                report.setVariable('cmn_sdiCode', replaceYeKe(vote.sdiCode));
                report.setVariable('cmn_address', replaceYeKe(vote.address));
                report.setVariable('cmn_ownerMessage', replaceYeKe(vote.ownerMessage));
                report.setVariable('cmn_freeup', replaceYeKe(vote.freeup));
                report.setVariable('cmn_freeupSdiCode', replaceYeKe(vote.freeupSdiCode));
                report.setVariable('cmn_freeupPrice', replaceYeKe(vote.freeupPrice));
                report.setVariable('cmn_unlockText', replaceYeKe(requestInfo.unlockText));
                report.setVariable('cmn_actText', replaceYeKe(requestInfo.actText));
            }





            /* BUDGET SPENT */
            else if (reportType == reportTypes.sup_budget_spent) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.budgetSpentMaster);
                    master.budgetSpentDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            /* BUDGET VARIANCE */
            else if (reportType == reportTypes.sup_budget_variance) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.budgetVarianceMaster);
                    master.budgetVarianceDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            /* NR ACTIVITIES MNG */
            else if (reportType == reportTypes.sup_nr_activities_mng) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.nrActivitiesMngMaster);
                    master.nrActivitiesMngDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            /* NR ACTIVITIES ZONES */
            else if (reportType == reportTypes.sup_nr_activities_zones) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.nrActivitiesZonesMaster);
                    master.nrActivitiesZonesDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            /* Hamle Ab Faza Sabz Zones */
            else if (reportType == reportTypes.sup_hamle_ab_faza_sabz_zones) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.hamleAbFazaSabzZonesMaster);
                    master.hamleAbFazaSabzZonesDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }


            /* Hamle Ab Makhzan Zones */
            else if (reportType == reportTypes.sup_hamle_ab_makhzan_zones) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.hamleAbMakhzanZonesMaster);
                    master.hamleAbMakhzanZonesDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            /* Hamle Ab Faza Sabz Mng */
            else if (reportType == reportTypes.sup_hamle_ab_faza_sabz_mng) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.hamleAbFazaSabzMngMaster);
                    master.hamleAbFazaSabzMngDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }


            /* Hamle Ab Makhzan Mng */
            else if (reportType == reportTypes.sup_hamle_ab_makhzan_mng) {
                var masters = [];
                var details = [];

                result.forEach(function (master) {
                    masters.push(master.hamleAbMakhzanMngMaster);
                    master.hamleAbMakhzanMngDetails.forEach(function (detail) {
                        details.push(detail);
                    });
                })
                var data = {
                    master: masters,
                    details: details
                }

                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }


            else if (reportType == reportTypes.sup_agenda) {
                var data = {
                    orderedActivitiyDetails: result.orderedActivitiyDetails,
                    FrmIOrderedActivityDTO: result,
                    contract: result.contract,
                    userSignatures: result.userSignatures

                }

                if (result.userSignatures) {
                    for (i = 0; i < result.userSignatures.length; i++) {

                        switch (result.userSignatures[i].roleKey) {

                            case 'zone_mayor':
                                report.setVariable('mayor', result.userSignatures[i].signaturePath);
                                report.setVariable('mayorName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'nazer_moghim':
                                report.setVariable('nazerMoghim', result.userSignatures[i].signaturePath);
                                report.setVariable('nazerMoghimName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'masoole_fazaye_sabz':
                                report.setVariable('nazerAlie', result.userSignatures[i].signaturePath);
                                report.setVariable('nazerAlieName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'karshenas_edare_kol_bebhud':
                                report.setVariable('behbud', result.userSignatures[i].signaturePath);
                                report.setVariable('behbudName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;
                            case 'peymankar':
                                report.setVariable('peymankar', result.userSignatures[i].signaturePath);
                                report.setVariable('peymankarName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;


                        }
                    }
                }



                //
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.sup_agenda_signed) {
                var data = {
                    orderedActivitiyDetails: result.orderedActivitiyDetails,
                    FrmIOrderedActivityDTO: result,
                    contract: result.contract,
                    userSignatures: result.userSignatures

                }

                if (result.userSignatures) {
                    for (i = 0; i < result.userSignatures.length; i++) {

                        switch (result.userSignatures[i].roleKey) {
                            case 'modir_mantagheh':
                                report.setVariable('mayor', result.userSignatures[i].signaturePath);
                                report.setVariable('mayorName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'nazer_moghim':
                                report.setVariable('nazerMoghim', result.userSignatures[i].signaturePath);
                                report.setVariable('nazerMoghimName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'masoole_fazaye_sabz':
                                report.setVariable('nazerAlie', result.userSignatures[i].signaturePath);
                                report.setVariable('nazerAlieName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'karshenas_arzyab_modir_nezarat':
                                report.setVariable('behbud', result.userSignatures[i].signaturePath);
                                report.setVariable('behbudName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'peymankar':
                                report.setVariable('peymankar', result.userSignatures[i].signaturePath);
                                report.setVariable('peymankarName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;
                        }
                    }
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.sup_agenda_paid) {
                var data = {
                    orderedActivitiyDetails: result.orderedActivitiyDetails,
                    FrmIOrderedActivityDTO: result,
                    contract: result.contract,
                    userSignatures: result.userSignatures
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.dry_danger_report) {
                var data = {
                    drydangerdetail: result,
                    dryDangerRequestDetail: result.dryDangerRequestDetail
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("datasource");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("datasource", "datasource", dataSet);

            }
            else if (reportType == reportTypes.estimateMin || reportType == reportTypes.estimate) {
                var seperatedResult = separateResults(result.priceListSections);
                result.estimate.startpage = getParameterByName("startpage");
                var data = {
                    estimate: result.estimate,
                    contract: result.contract,
                    priceListSections: result.priceListSections,
                    priceList: seperatedResult.priceLists.sort((a, b) => a.code - b.code),
                    category: seperatedResult.categories.sort((a, b) => a.code - b.code),
                    field: seperatedResult.fields.sort((a, b) => a.code - b.code),
                    seasons: seperatedResult.seasons.sort((a, b) => a.code - b.code),
                    rows: seperatedResult.rows.sort((a, b) => a.code - b.code),
                    coefficients: result.coefficients
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.estimationTotalMin) {
                var seperatedResult = separateResults(result.priceListSections);
                result.estimate.startpage = getParameterByName("startpage");
                var data = {
                    estimate: result.estimate,
                    field: seperatedResult.fields.sort((a, b) => a.code - b.code),
                    financialSummary: result.financialSummary,
                    coefficients: result.coefficients
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.estimationFieldMin) {
                var seperatedResult = separateResults(result.priceListSections);
                result.estimate.startpage = getParameterByName("startpage");
                var data = {
                    estimate: result.estimate,
                    seasons: seperatedResult.seasons.sort((a, b) => a.code - b.code),
                    field: seperatedResult.fields.sort((a, b) => a.code - b.code),
                    financialSummary: result.financialSummary.sort((a, b) => a.fieldCode - b.fieldCode),
                    coefficients: result.coefficients
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.sdSpeciesDraftReport || reportType == reportTypes.specialSdspeciesDraftReport) {
                var data = {
                    draftDetails: result.sdSpeciesDraftsDetails.map(item => {
                        return {
                            sdSpeciesTitle: item.sdSpeciesTitle,
                            amount: item.acceptedAmount == null ? item.amount : item.acceptedAmount,
                            qualityTitle: item.qualityTitle,
                            speciesCode: item.sdSpeciesCode,
                            id: item.id,
                            draftId: item.sdSpeciesDraftsId,
                        }
                    }),
                    draft: {
                        id: result.id,
                        reportDate: result.reportDatePersian,
                        finalReportDate: result.finalReportDatePersian,
                        draftReportEndTime: result.draftReportEndTime,
                        deliveryDate: result.draftReportDeliveryDate,
                        deliveryTime: result.draftReportDeliveryTime,
                        draftRequestWorkflowNo: result.draftRequestWorkflowNo,
                        requestWorkflowNo: result.requestWorkflowNo,
                        noteBookTitle: result.noteBookTitle,
                        zoneName: result.zoneName,
                        contractAddress: result.contractAddress,
                    },
                    carDetails: {
                        id: result.sdSpeciesCarDriver != null ? result.sdSpeciesCarDriver.id : null,
                        carPlate: result.sdSpeciesCarDriver != null ? result.sdSpeciesCarDriver.carPlate : null,
                        driverName: result.sdSpeciesCarDriver != null ? result.sdSpeciesCarDriver.name : null,
                        draftId: result.id,
                    },
                    usersInDraft: result.usersInMainWorkflow.map(item => {
                        return {
                            ...item,
                            fullName: item.firstName + ' ' + item.lastName
                        }
                    }),
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                var tolidKonandeh = result.usersInMainWorkflow.filter(usersInWFL => usersInWFL.roleKey.toUpperCase() == "inventory_namayandeh_park".toUpperCase() || usersInWFL.roleKey.toUpperCase() == "peymankar".toUpperCase().toUpperCase())[0];
                var tahvilGirandeh = result.usersInMainWorkflow.filter(usersInWFL => usersInWFL.roleKey.toUpperCase() == "negahbani".toUpperCase())[0];

                if (tahvilGirandeh == null)
                    tahvilGirandeh = result.usersInMainWorkflow.filter(usersInWFL => usersInWFL.roleKey.toUpperCase() == "nazer_moghim".toUpperCase() || usersInWFL.roleKey.toUpperCase() == "Requseter_Gune".toUpperCase())[0];

                report.setVariable('tolidkonandeh', tolidKonandeh != null ? tolidKonandeh.firstName + ' ' + tolidKonandeh.lastName : null);
                report.setVariable('tahvilGirandeh', tahvilGirandeh != null ? tahvilGirandeh.firstName + ' ' + tahvilGirandeh.lastName : null);
                report.setVariable('tahvilGirandehRoleName', tahvilGirandeh != null ? tahvilGirandeh.roleName : null);
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.sdSpeciesInventoryChargeReport) {
                var data = {
                    inventoryChargeDetails: result.sdSpeciesInventoryChargeRequestDetails.map(item => {
                        return {
                            sdSpeciesTitle: item.sdSpeciesRealTitle,
                            amount: item.confirmedAmount == null ? item.amount : item.confirmedAmount,
                            speciesCode: item.sdSpeciesCode,
                            id: item.id,
                            inventoryChargeId: item.sdSpeciesInventoryChargeRequestId,
                        }
                    }),
                    inventoryCharge: {
                        id: result.id,
                        reportDate: result.reportDatePersian,
                        deliveryDate: result.draftReportDeliveryDate,
                        deliveryTime: result.draftReportDeliveryTime,
                        contractAddress: result.contractAddress,
                        contractName: result.contractName,
                        finalReportDate: result.finalReportDate,
                        inventoryName: result.inventoryTitle,
                        requestNo: result.requestNo
                    },
                    carDetails: {
                        id: result.sdSpeciesCarDriver != null ? result.sdSpeciesCarDriver.id : null,
                        carPlate: result.sdSpeciesCarDriver != null ? result.sdSpeciesCarDriver.carPlate : null,
                        driverName: result.sdSpeciesCarDriver != null ? result.sdSpeciesCarDriver.name : null,
                        driverPhoneNo: result.sdSpeciesCarDriver != null ? result.sdSpeciesCarDriver.phoneNumber : null,
                        inventoryChargeId: result.id,
                    },
                    usersInDraft: result.usersInMainWorkflow.map(item => {
                        return {
                            ...item,
                            fullName: item.firstName + ' ' + item.lastName
                        }
                    }),
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                var tolidKonandeh = result.usersInMainWorkflow.filter(usersInWFL => usersInWFL.roleKey == "peymankar")[0];
                var tahvilGirandeh = result.usersInMainWorkflow.filter(usersInWFL => usersInWFL.roleKey == "responsible_species_distribution")[0];
                report.setVariable('tolidkonandeh', tolidKonandeh != null ? tolidKonandeh.firstName + ' ' + tolidKonandeh.lastName : null);
                report.setVariable('tahvilGirandeh', tahvilGirandeh != null ? tahvilGirandeh.firstName + ' ' + tahvilGirandeh.lastName : null);
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.supInvoiceReport) {

                var data = {
                    invoiceDetails: {
                        contractName: result.contractName,
                        invoiceNo: result.invoiceNo
                    },
                    priceList: result.priceList,
                    category: result.categories,
                    field: result.fields,
                    seasons: result.seasons,
                    rows: result.rows,
                    amenities: result.amenities,
                }


                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.sup_invoice_and_human_report) {

                var data = {
                    invoiceDetails: {
                        contractName: result.contractName,
                        invoiceNo: result.invoiceNo
                    },
                    priceList: result.priceList,
                    category: result.categories,
                    field: result.fields,
                    seasons: result.seasons,
                    rows: result.rows,
                }




                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.sup_invoice_and_human_integrated_report) {

                var data = {
                    invoiceDetails: {
                        contractName: result.contractName,
                        invoiceNo: result.invoiceNo
                    },
                    priceList: result.priceList,
                    category: result.categories,
                    field: result.fields,
                    seasons: result.seasons,
                    rows: result.rows,
                    amenities: result.amenities,
                }




                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.sup_invoice_report_023_169) {

                var data = {
                    invoiceDetails: {
                        contractName: result.contractName,
                        invoiceNo: result.invoiceNo,
                        zoneName: result.zoneName,
                        regionName: result.regionName,
                        contractAddress: result.contractAddress,
                        contractorName: result.contractorName,
                        ownerName: result.ownerName,
                        contractNo: result.contractNo,
                        contractDate: result.contractDate,
                        contractDay: result.contractDay + " " + "ماه",
                        companyName: result.companyName,
                        year: result.year,
                        month: getMonthNameString(result.month),
                        estimateContractorPrice: result.estimateContractorPrice,
                    },
                    priceList: result.priceList,
                    category: result.categories,
                    field: result.fields,
                    seasons: result.seasons,
                    rows: result.rows,
                    amenities: result.amenities,
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                if (result.usersInMainWorkflow && result.usersInMainWorkflow.length > 0) {
                    var nazerMoghim = result.usersInMainWorkflow.filter(usersInWFL => usersInWFL.roleKey == "nazer_moghim")[0];
                    report.setVariable('nazerMoghim', nazerMoghim != null ? nazerMoghim.firstName + ' ' + nazerMoghim.lastName : null);
                }
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.sup_invoice_adjustment_report_023_169 || reportType == reportTypes.sup_invoice_adjustment_report) {

                var data = {
                    invoiceDetails: {
                        contractName: result.contractName,
                        invoiceNo: result.invoiceNo,
                        zoneName: result.zoneName,
                        regionName: result.regionName,
                        contractAddress: result.contractAddress,
                        contractorName: result.contractorName,
                        ownerName: result.ownerName,
                        contractNo: result.contractNo,
                        contractDate: result.contractDate,
                        contractDay: result.contractDay + " " + "ماه",
                        companyName: result.companyName,
                        year: result.year,
                        month: getMonthNameString(result.month),
                        estimateContractorPrice: result.estimateContractorPrice,
                        invoiceAdjustmentNo: result.invoiceAdjustmentNo,
                    },
                    priceList: result.priceList,
                    category: result.categories,
                    field: result.fields,
                    seasons: result.seasons,
                    rows: result.rows,
                    amenities: result.amenities,
                    adjustmentDetails: result.adjustmentDetails,
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                if (result.usersInMainWorkflow && result.usersInMainWorkflow.length > 0) {
                    var nazerMoghim = result.usersInMainWorkflow.filter(usersInWFL => usersInWFL.roleKey == "nazer_moghim")[0];
                    report.setVariable('nazerMoghim', nazerMoghim != null ? nazerMoghim.firstName + ' ' + nazerMoghim.lastName : null);
                }
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.estimationField) {
                var seperatedResult = separateResults(result.priceListSections);
                result.estimate.startpage = getParameterByName("startpage");
                var data = {
                    estimate: result.estimate,
                    field: seperatedResult.fields.sort((a, b) => a.code - b.code),
                    seasons: seperatedResult.seasons.sort((a, b) => a.code - b.code),
                    rowsCoefficients: result.rowsCoefficients,
                    totalCoefficients: result.totalCoefficients,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.estimationTotal) {
                var seperatedResult = separateResults(result.priceListSections);
                result.estimate.startpage = getParameterByName("startpage");
                var data = {
                    estimate: result.estimate,
                    field: seperatedResult.fields.sort((a, b) => a.code - b.code),
                    seasons: seperatedResult.seasons.sort((a, b) => a.code - b.code),
                    rowsCoefficients: result.rowsCoefficients,
                    totalCoefficients: result.totalCoefficients,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.estimateReport1232579Table1 || reportType == reportTypes.estimateReport1232579Table1WithUpperHead) {

                var fileTitle = result.estimateTitle;
                var executiveBranchTitle = "";
                if (reportType == reportTypes.estimateReport1232579Table1) {
                    fileTitle = result.estimateTitle
                    executiveBranchTitle = result.executiveBranchTitle;
                }
                else {
                    fileTitle = "فرم انالیز پیمان " + result.estimateTitle + " با اعمال ضرایب (کلیه ردیف ها) ";
                }

                var data = {
                    estimate: {
                        title: fileTitle,
                        ejrayi: "شهرداری مشهد",
                        executiveBranchTitle: executiveBranchTitle,
                        startpage: getParameterByName("startpage")
                    },
                    rows: result.rows,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.estimateReport1232579Table2 || reportType == reportTypes.estimateReport1232579Table2WithUpperHead) {

                var fileTitle = result.estimateTitle;
                var executiveBranchTitle = "";
                if (reportType == reportTypes.estimateReport1232579Table2) {
                    fileTitle = result.estimateTitle
                    executiveBranchTitle = result.executiveBranchTitle;
                }
                else {
                    fileTitle = "فرم ردیف های مشمول تجزیه بها (" + getParameterByName("thresholdPercent") + "درصد مبلغ اسناد) پیمان " + result.estimateTitle + " (با اعمال ضرایب) ";
                }

                var data = {
                    estimate: {
                        title: fileTitle,
                        ejrayi: "شهرداری مشهد",
                        executiveBranchTitle: executiveBranchTitle,
                        startpage: getParameterByName("startpage"),
                        thresholdPercent: getParameterByName("thresholdPercent")
                    },
                    rows: result.rows,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.estimateReport1232579Table3 || reportType == reportTypes.estimateReport1232579Table4) {
                var data = {
                    estimate: {
                        title: result.estimateTitle,
                        ejrayi: "شهرداری مشهد",
                        executiveBranchTitle: result.executiveBranchTitle,
                        startpage: getParameterByName("startpage")
                    },
                    rows: result.rowsTable3,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.estimateReport10076574TableA || reportType == reportTypes.estimateReport10076574TableP) {
                var data = {
                    estimate: {
                        estimateTitle: result.estimateTitle,
                        projectTitle: result.projectTitle,
                        contractTitle: result.contractTitle,
                        priceListYearCode: result.priceListYearCode,
                        startpage: getParameterByName("startpage"),
                        place: "شهرداری مشهد"
                    },
                    seasons: result.seasons,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }
            else if (reportType == reportTypes.sup_agenda_paid_signed) {
                var data = {
                    orderedActivitiyDetails: result.orderedActivitiyDetails,
                    FrmIOrderedActivityDTO: result,
                    contract: result.contract,
                    //userSignatures: result.userSignatures
                }
                if (result.workflowStep.key === "SUP_15_ZoneMoavenFaniEjrayi_Roonevesht") {
                    data.userSignatures = result.userSignatures;

                    if (result.userSignatures) {
                        for (i = 0; i < result.userSignatures.length; i++) {

                            switch (result.userSignatures[i].roleKey) {
                                case 'modir_mantagheh':
                                    report.setVariable('mayor', result.userSignatures[i].signaturePath);
                                    report.setVariable('mayorName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));
                                    break;

                                case 'nazer_moghim':
                                    report.setVariable('nazerMoghim', result.userSignatures[i].signaturePath);
                                    report.setVariable('nazerMoghimName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));
                                    break;

                                case 'masoole_fazaye_sabz':
                                    report.setVariable('nazerAlie', result.userSignatures[i].signaturePath);
                                    report.setVariable('nazerAlieName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));
                                    break;

                                case 'karshenas_arzyab_modir_nezarat':
                                    report.setVariable('behbud', result.userSignatures[i].signaturePath);
                                    report.setVariable('behbudName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));
                                    break;

                                case 'peymankar':
                                    report.setVariable('peymankar', result.userSignatures[i].signaturePath);
                                    report.setVariable('peymankarName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));
                                    break;
                            }
                        }
                    }
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.sup_monthly_assessments ||
                reportType == reportTypes.sup_three3month_assessments ||
                reportType == reportTypes.sup_three4month_assessments ||
                reportType == reportTypes.sup_six6month_assessments ||
                reportType == reportTypes.sup_six7month_assessments ||
                reportType == reportTypes.sup_six8month_assessments) {

                var data = {
                    assessment: {
                        assessmentNo: result.assessmentNo,
                        assessmentDate: result.assessmentDate,
                        assessmentScore: result.assessmentScore,
                        assessmentDescription: result.assessmentDescription,
                        assessmentTitle: result.assessmentTitle,
                        assessmentFinalRank: result.assessmentFinalRank
                    },
                    assessmentDetails: result.assessmentDetails,
                    contract: result.contract
                }
                if (result.userSignature) {
                    report.setVariable('signaturePath', result.userSignature.signaturePath);
                    report.setVariable('signatureName', replaceYeKe(result.userSignature.firstName + ' ' + result.userSignature.lastName));
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.regions_evaluation) {


                var data = {
                    evaluation: {
                        requestNo: result.requestCode,
                        year: result.yearName,
                        month: result.monthName,
                        zoneName: result.zoneName,
                        desciption: result.desciption

                    },
                    evaluationDetails: result.regionsPreformanceEvaluationDetail,
                    contract: result.contract
                }
                if (result.userSignature) {
                    report.setVariable('signaturePath', result.userSignature.signaturePath);
                    report.setVariable('signatureName', replaceYeKe(result.userSignature.firstName + ' ' + result.userSignature.lastName));
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);

            }

            else if (reportType == reportTypes.overal_regions_evaluation) {


                var data = {
                    evaluationOveral: result.zoneScores
                }
                report.setVariable('monthName', result.monthName);
                report.setVariable('yearName', result.yearName);

                if (result.userSignature) {
                    report.setVariable('signaturePath', result.userSignature.signaturePath);
                    report.setVariable('signatureName', replaceYeKe(result.userSignature.firstName + ' ' + result.userSignature.lastName));
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);

            }


            else if (reportType == reportTypes.sup_temp_commission ||
                reportType == reportTypes.sup_certain_commission ||
                reportType == reportTypes.sup_certain_end_commission

            ) {

                var data = {
                    commission: result.commission,
                    contract: result.contract
                }




                if (result && result.userSignatures) {
                    data.userSignatures = result.userSignatures;
                    for (i = 0; i < result.userSignatures.length; i++) {

                        switch (result.userSignatures[i].roleKey) {
                            case 'peymankar':
                                report.setVariable('peymankar', result.userSignatures[i].signaturePath);
                                report.setVariable('peymankarName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'nazer_moghim':
                                report.setVariable('nazerMoghim', result.userSignatures[i].signaturePath);
                                report.setVariable('nazerMoghimName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'masoole_fazaye_sabz':
                                report.setVariable('nazerAlie', result.userSignatures[i].signaturePath);
                                report.setVariable('nazerAlieName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'modir_mantagheh':
                                report.setVariable('mayor', result.userSignatures[i].signaturePath);
                                report.setVariable('mayorName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'zone_moaven_fanni_ejrayi':
                                report.setVariable('moavenFanni', result.userSignatures[i].signaturePath);
                                report.setVariable('moavenFanniName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'moaven_maali_edari_mantaghe':
                                report.setVariable('moavenMaali', result.userSignatures[i].signaturePath);
                                report.setVariable('moavenMaaliName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'modir_kol_behbood_mohit_zist':
                                report.setVariable('behbood', result.userSignatures[i].signaturePath);
                                report.setVariable('behboodName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'sup_namayande_shora':
                                report.setVariable('shora', result.userSignatures[i].signaturePath);
                                report.setVariable('shoraName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;

                            case 'sup_moaven_khadamat_shahri':
                                report.setVariable('moavenKhadamatShahri', result.userSignatures[i].signaturePath);
                                report.setVariable('moavenKhadamatShahriName', replaceYeKe(result.userSignatures[i].firstName + ' ' + result.userSignatures[i].lastName));

                                break;
                        }
                    }
                }


                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.arbor_day_drafts) {

                var data = {
                    draft: result,
                    draftDetails: result.details
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.mlg_donor ||
                reportType == reportTypes.mlg_birth ||
                reportType == reportTypes.mlg_dead ||
                reportType == reportTypes.mlg_marriage ||
                reportType == reportTypes.mlg_birth_copy) {

                var data = {
                    request: result,
                    clients: result.clients,
                    attachments: result.clients[0].attachments.filter(item => item.attachType == 1)
                }

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
                report.setVariable('attachPath', result.clients[0].attachments
                    .filter(item => item.attachType == 1)
                    .map((value, index) => { return `/Uploads/memoryLifeGarden/${value.fileName}` }
                    ));
            }

            else if (reportType == reportTypes.cmn_cut_tree_own) {
                var visitInfo = [];
                var plantInfo = [];

                //Find RequestFloors
                var requestFloorsInfo = result.visit1.requestFloors.filter(item => item.requestID == result.visit1.requestID);

                //Find visit etails of a floor
                requestFloorsInfo.forEach((itemMain) => {
                    var visitDetailsInfo = itemMain.visitDetails.rows.filter(item => item.requestFloorID == itemMain.id);
                    visitDetailsInfo.forEach((mainItem) => {
                        mainItem.plantStatusDTO.filter(item => item.visitDetailID == mainItem.id).map((value, index) => {
                            switch (value.plantStatusID) {
                                case 1:
                                    mainItem.maarezNama = value.statusPercent;
                                    break;
                                case 2:
                                    mainItem.maarezParking = value.statusPercent;
                                    break;
                                case 3:
                                    mainItem.nabeja = value.statusPercent;
                                    break;
                                case 4:
                                    mainItem.maarezKonsul = value.statusPercent;
                                    break;
                                case 5:
                                    mainItem.khoshkide = value.statusPercent;
                                    break;
                                case 6:
                                    mainItem.khatari = value.statusPercent;
                                    break;
                                case 7:
                                    mainItem.afatoBimar = value.statusPercent;
                                    break;
                                case 41:
                                    mainItem.maarezAmaliatSakhtemani = value.statusPercent;
                                    break;
                                case 42:
                                    mainItem.maarezDideTablo = value.statusPercent;
                                    break;
                                case 43:
                                    mainItem.maarezShakhe = value.statusPercent;
                                    break;
                                case 81:
                                    mainItem.derakhtGhataei = value.statusPercent;
                                    break;
                                case 101:
                                    mainItem.haras = value.statusPercent;
                                    break;
                                case 102:
                                    mainItem.asibDide = value.statusPercent;
                                    break;
                                case 103:
                                    mainItem.shakheZani = value.statusPercent;
                                    break;
                                case 201:
                                    mainItem.atashSouzi = value.statusPercent;
                                    break;
                                default:
                            }
                            return null;
                        })
                    })
                    visitInfo = visitDetailsInfo;
                });

                //Find plant status of a tree
                visitInfo.forEach((mainItem) => {
                    var plantstatus = mainItem.plantStatusDTO.filter(item => item.visitDetailID == mainItem.id);
                    plantInfo = plantstatus;
                });

                var data = {
                    request: result,
                    visit: result.visit1,
                    visitDetail: visitInfo,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.cmn_cut_tree_own_empty) {
                var visitInfo = [];

                //Find RequestFloors
                var requestFloorsInfo = result.visit1.requestFloors.filter(item => item.requestID == result.visit1.requestID);

                //Find visit etails of a floor
                requestFloorsInfo.forEach((itemMain) => {
                    var visitDetailsInfo = itemMain.visitDetails.rows.filter(item => item.requestFloorID == itemMain.id);
                    visitInfo = visitDetailsInfo;
                });


                var data = {
                    request: result,
                    visit: result.visit1,
                    visitDetail: visitInfo,
                }
                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            else if (reportType == reportTypes.mlg_all_request_export) {
                var data = {
                    request: result,
                    clients: result.map((value, index) => {
                        return value.clients;
                    })
                };

                var dataSet = new Stimulsoft.System.Data.DataSet("ds");
                dataSet.readJson(data);
                report.dictionary.databases.clear();
                report.regData("ds", "ds", dataSet);
            }

            /* preparing filters display text */
            var filtersParam = getParameterByName("filters");
            if (filtersParam) {
                var filters = JSON.parse(filtersParam);
                var filtersArray = [];

                Object.keys(filters).forEach(function (key) {
                    if (filters[key].excludeFromHumanReadableText)
                        return;

                    //if (!filters[key].valueStr || filters[key].valueStr == "()")
                    //    return;

                    if ((!filters[key].value
                        || filters[key].value == "[]"
                        || filters[key].value == []
                        || filters[key].value == ''
                        || filters[key].value == '\"\"')

                        &&

                        (!filters[key].value2
                            || filters[key].value2 == "[]"
                            || filters[key].value2 == []
                            || filters[key].value2 == ''
                            || filters[key].value2 == '\"\"')
                    )
                        return;

                    var value1 = filters[key].valueStr || filters[key].value;
                    var value2 = filters[key].value2;

                    // age Value e main NULL nabashe
                    if (filters[key].value
                        && filters[key].value != "[]"
                        && filters[key].value != []
                        && filters[key].value != ''
                        && filters[key].value != '\"\"') {
                        switch (+filters[key].type) {
                            case 0:
                                // Equals
                                filtersArray.push(filters[key].title + " = " + value1);
                                break;
                            case 1:
                                // NotEquals
                                filtersArray.push(filters[key].title + " <> " + value1);
                                break;
                            case 2:
                                // Contains
                                filtersArray.push(filters[key].title + " شامل: " + value1);
                                break;
                            case 4:
                                // LittleThan
                                filtersArray.push(filters[key].title + " <= " + value1);
                                break;
                            case 5:
                                // BiggerThan
                                filtersArray.push(filters[key].title + " >= " + value1);
                                break;
                            case 6:
                                // Between
                                filtersArray.push(filters[key].title + " بین: " + (value1 || " -- ") + " و " + (value2 || " -- "));
                                break;
                            case 7:
                                // NotContains
                                filtersArray.push(filters[key].title + " شامل نیست: " + value1);
                                break;
                            case 8:
                                // NullOrNotEquals
                                filtersArray.push(filters[key].title + " خالی یا نامساوی: " + value1);
                                break;
                            default:
                        }
                    }


                    // age Value e main NULL bashe va Value2 NULL nabashe
                    else if (filters[key].value2
                        && filters[key].value2 != "[]"
                        && filters[key].value2 != []
                        && filters[key].value2 != ''
                        && filters[key].value2 != '\"\"') {

                        switch (+filters[key].type) {
                            case 6:
                                // Between
                                filtersArray.push(filters[key].title + " بین: " + (" -- ") + " و " + (value2 || " -- "));
                                break;

                            default:
                        }
                    }
                })

                var allFiltersText = filtersArray.join(' - ');
                report.setVariable('allFiltersText', replaceYeKe(allFiltersText));
            }

            report.setVariable('ip', footerInfo.ip);
            report.setVariable('fullName', replaceYeKe(footerInfo.fullName));
            report.setVariable('username', footerInfo.username);
            report.setVariable('pDate', footerInfo.date);
        })
}

function createDesigner() {


    var options = new Stimulsoft.Designer.StiDesignerOptions();
    options.appearance.fullScreenMode = true;
    options.appearance.htmlRenderMode = Stimulsoft.Report.Export.StiHtmlExportMode.Table;

    // Create an instance of the designer
    designer = new Stimulsoft.Designer.StiDesigner(options, "StiDesigner", false);

    // Add the exit menu item event
    designer.onExit = function (e) {
        this.visible = false;
        viewer.visible = true;
    };

    designer.renderHtml("designerContent");
}

function separateResults(data) {
    var priceLists = [];
    var categories = [];
    var fields = [];
    var seasons = [];
    var rows = [];

    data.forEach(function (node) {
        separateNode(node, priceLists, categories, fields, seasons, rows);
    });

    return {
        priceLists: priceLists,
        categories: categories,
        fields: fields,
        seasons: seasons,
        rows: rows
    };
};

function separateNode(node, priceLists, categories, fields, seasons, rows) {
    switch (node.code.length) {
        case 2:
            priceLists.push(node);
            break;
        case 4:
            categories.push(node);
            break;
        case 7:
            fields.push(node);
            break;
        case 9:
            seasons.push(node);
            break;
        default:
            var text = node.estimateDetail.priceType == 1 ? 'ف' : node.estimateDetail == 2 ? 'کا' : node.estimateDetail == 3 ? '*ف' : '*غ';
            rows.push({ ...node.estimateDetail, title: node.title, parentCode: node.parentCode, priceTypeText: text });
            break;
    }

    node.childs.forEach(function (child) {
        separateNode(child, priceLists, categories, fields, seasons, rows);
    });
}

function getQueryStringParam(name, url) {
    if (!url) url = window.location.href.toLowerCase();
    name = name.replace(/[\[\]]/g, '\\$&').toLowerCase();
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function getParameterByName(name) {
    var guid = getQueryStringParam('guid');
    if (guid == null || guid == '') return getQueryStringParam(name)

    var data = sessionStorage.getItem(guid);
    if (data != null)
        return JSON.parse(data)[name];

    return null;
}

function getParameterByInstance() {
    var guid = getQueryStringParam('instanceGuid');

    if (guid == null || guid == '') return null

    return guid;
}

function getMonthNameString(value) {
    var ret = "";
    if (value) {

        switch (value) {
            case "01":
                ret = "فروردین"
                break;

            case "02":
                ret = "اردیبهشت"
                break;

            case "03":
                ret = "خرداد"
                break;

            case "04":
                ret = "تیر"
                break;

            case "05":
                ret = "مرداد"
                break;

            case "06":
                ret = "شهریور"
                break;

            case "07":
                ret = "مهر"
                break;


            case "08":
                ret = "آبان"
                break;


            case "09":
                ret = "آذر"
                break;


            case "10":
                ret = "دی"
                break;


            case "11":
                ret = "بهمن"
                break;


            case "12":
                ret = "اسفند"
                break;
        }
    }
    return ret;
}

function replaceYeKe(value) {
    if (!value)
        return value;

    if (isNaN(value))
        if (value.length == 0)
            return value;

    if (Array.isArray(value) && value[0]) {
        var keys = Object.keys(value[0]);
        value.forEach(function (item) {
            keys.forEach(function (key) {
                item[key] = replaceYeKe(item[key]);
            })
        });
        return value;
    } else {
        if (isNaN(value))
            return ("" + value).replace(/ی/gmi, "ي").replace(/ک/gmi, "ك");
        else {
            return value;
        }
    }
}

function normalizeImagePath(path) {
    if (path == null || path == '')
        return '/assets/img/no-image.jpg';

    if (isImage(path))
        return '/uploads/commission/' + path;
    else
        return '/assets/img/no-image.jpg';
}

function isImage(str) {
    str = str.toLowerCase();

    if (str.indexOf('.jpg') > -1)
        return true;
    if (str.indexOf('.png') > -1)
        return true;
    if (str.indexOf('.bmp') > -1)
        return true;
    if (str.indexOf('.gif') > -1)
        return true;
    if (str.indexOf('.jpeg') > -1)
        return true;

    return false;
}

(function ($) {
    $(document).ready(function () {
        createViewer();
    })
})(jQuery)